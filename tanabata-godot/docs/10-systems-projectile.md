# ProjectileSystem (система снарядов)

## Назначение

Двигает снаряды к целям, наносит урон при попадании, обновляет вспышки урона и лазеры.

## Движение снарядов

Для каждого снаряда вычисляется направление к цели (позиция врага). Снаряд движется с заданной скоростью. Позиция обновляется в ECS напрямую (не через velocity).

## Самонаведение (homing)

- **Полный homing** (каждый кадр): снаряды с флагом `homing: true` (осколки Малахита) каждый кадр летят строго в текущую позицию цели.
- **Потиковая донаводка** (оптимизировано): для остальных снарядов раз в HOMING_TICK_INTERVAL (0.06 с) направление плавно корректируется к текущей позиции цели. Включение только когда расстояние до цели меньше HOMING_ACTIVATE_DISTANCE (200 px). Сила поворота — HOMING_CORRECTION_STRENGTH (0.18). Таймер _homing_t хранится в данных снаряда. Так снижается число промахов из-за замедлений/ускорений врагов без расчёта каждый кадр.

Пересчёт курса при изменении slow_factor цели выполняется сразу через _recalculate_target_position.

## Попадание

Когда расстояние до цели меньше чем скорость за один кадр (или меньше порога) — считается попаданием. Наносится урон, снаряд удаляется. Урон учитывает броню врага по типу атаки (physical, magical, pure). Минимум 1 урон если базовый урон больше нуля.

**Impact burst** (Malachite) — при попадании в радиусе 3 гексов создаются вторичные снаряды к соседям (до 6 целей, 40% урона); у этих снарядов homing: true.

**JADE_POISON** — при попадании добавляется стак в ecs.jade_poisons. DoT и замедление обрабатываются StatusEffectSystem и MovementSystem.

## Смерть врага

При health <= 0 враг сразу удаляется из ECS (destroy_entity). Визуал убирается через пул.

## Вспышки урона

Компонент damage_flash у врага — таймер. При уроне ставится 0.2 сек. Каждый кадр таймер уменьшается. При нуле компонент удаляется. Рендерер подсвечивает врага белым пока таймер активен.

## Лазеры

Компонент laser хранит start_pos, target_pos, timer, color. Каждый кадр таймер уменьшается (шаг не больше 0.06 с). При нуле сущность удаляется. Длительность задаётся Config.LASER_DURATION (0.4 с). Рендерер рисует линию между точками на LaserLayer. Лазеры не двигаются — это мгновенный эффект.
