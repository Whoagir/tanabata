

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ Tanabata ‚Äî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–æ–ª–æ-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

–ë—Ä–æ, —è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–ª –≤—Å—ë. –£ —Ç–µ–±—è —Å–µ—Ä—å—ë–∑–Ω–∞—è –±–∞–∑–∞ ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥—É–º–∞–Ω–∞, ECS –µ—Å—Ç—å, —Å–ª–æ–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã, data-driven –ø–æ–¥—Ö–æ–¥ –Ω–∞ –º–µ—Å—Ç–µ. –ù–æ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Å—Ç–∞, –≥–¥–µ —Ç—ã –º–æ–∂–µ—à—å —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å —Å–µ–±–µ –∫—É—á—É –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ—Ä–≤–æ–≤. –†–∞–∑–±–µ—Ä—ë–º –ø–æ –ø–æ—Ä—è–¥–∫—É.

---

## 1. üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–º–∏)

### 1.1. –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Ñ–∞–∑ —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ 3+ —Ñ–∞–π–ª–∞–º

–≠—Ç–æ —Ç–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –±–æ–ª—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ø–µ—Ä–µ—Ö–æ–¥—ã BUILD ‚Üí SELECTION ‚Üí WAVE –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–æ—á–∏—Å—Ç–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π, —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞, —Å–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–æ–≤) –∂–∏–≤—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ `game_root.gd`, `game_hud.gd` –∏ `info_panel.gd`. –¢—ã —Å–∞–º —ç—Ç–æ –æ—Ç–º–µ—Ç–∏–ª –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –ö–æ–≥–¥–∞ —Ç—ã –¥–æ–±–∞–≤–∏—à—å –Ω–æ–≤—É—é —Ñ–∞–∑—É –∏–ª–∏ –∏–∑–º–µ–Ω–∏—à—å –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞ ‚Äî –ø—Ä–∏–¥—ë—Ç—Å—è –º–µ–Ω—è—Ç—å –≤ —Ç—Ä—ë—Ö –º–µ—Å—Ç–∞—Ö, –∏ —Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–±—É–¥–µ—à—å –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö.

**–†–µ—à–µ–Ω–∏–µ ‚Äî PhaseController (–æ–¥–∏–Ω —Ñ–∞–π–ª, –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å):**

```gdscript
# core/systems/phase_controller.gd
class_name PhaseController

var ecs: ECSWorld
var hex_map: HexMap
var energy_network: EnergyNetworkSystem

func transition_to(new_phase: int) -> bool:
    var current = ecs.game_state["phase"]
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
    if not _is_valid_transition(current, new_phase):
        return false
    
    # –í—ã—Ö–æ–¥ –∏–∑ —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑—ã
    _exit_phase(current)
    
    # –í—Ö–æ–¥ –≤ –Ω–æ–≤—É—é
    ecs.game_state["phase"] = new_phase
    _enter_phase(new_phase)
    
    return true

func _exit_phase(phase: int):
    match phase:
        GameTypes.BUILD_STATE:
            pass  # –ù–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ
        GameTypes.TOWER_SELECTION_STATE:
            _finalize_selection()  # –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
        GameTypes.WAVE_STATE:
            _cleanup_wave_entities()

func _enter_phase(phase: int):
    match phase:
        GameTypes.BUILD_STATE:
            ecs.game_state["towers_built_this_phase"] = 0
        GameTypes.TOWER_SELECTION_STATE:
            pass
        GameTypes.WAVE_STATE:
            # wave_system —Å–∞–º –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç

func _finalize_selection():
    # –í–°–Ø –ª–æ–≥–∏–∫–∞ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ó–î–ï–°–¨ –∏ –¢–û–õ–¨–ö–û –ó–î–ï–°–¨
    for entity_id in ecs.towers.keys():
        var tower = ecs.towers[entity_id]
        if tower.get("is_temporary", false):
            if tower.get("is_selected", false):
                tower["is_temporary"] = false
                tower["is_permanent"] = true
            else:
                _convert_to_wall(entity_id)

func _cleanup_wave_entities():
    # –£–¥–∞–ª–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–æ–≤, –ª–∞–∑–µ—Ä–æ–≤ –∏ —Ç.–¥.
    for id in ecs.projectiles.keys():
        ecs.destroy_entity(id)

func _is_valid_transition(from: int, to: int) -> bool:
    var valid = {
        GameTypes.BUILD_STATE: [GameTypes.TOWER_SELECTION_STATE],
        GameTypes.TOWER_SELECTION_STATE: [GameTypes.WAVE_STATE],
        GameTypes.WAVE_STATE: [GameTypes.BUILD_STATE],
    }
    return to in valid.get(from, [])
```

–¢–µ–ø–µ—Ä—å `game_hud.gd` –∏ `info_panel.gd` –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞—é—Ç:
```gdscript
phase_controller.transition_to(GameTypes.WAVE_STATE)
```

–ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ —Ñ–∞–∑ –≤ UI. –í–æ–æ–±—â–µ.

---

### 1.2. ECS –Ω–∞ —Å–ª–æ–≤–∞—Ä—è—Ö ‚Äî –±–æ–º–±–∞ –∑–∞–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –≤ GDScript —Å–ª–æ–≤–∞—Ä–∏ –Ω–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã. –¢—ã –±—É–¥–µ—à—å –ª–æ–≤–∏—Ç—å –±–∞–≥–∏ –≤–∏–¥–∞ `tower["is_selectd"]` (–æ–ø–µ—á–∞—Ç–∫–∞) —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ, —á–µ—Ä–µ–∑ 20 –º–∏–Ω—É—Ç –∏–≥—Ä—ã, –∫–æ–≥–¥–∞ –¥–æ–π–¥—ë—à—å –¥–æ –Ω—É–∂–Ω–æ–π —Ñ–∞–∑—ã.

**–†–µ—à–µ–Ω–∏–µ ‚Äî Resource-–∫–ª–∞—Å—Å—ã –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

```gdscript
# core/components/tower_component.gd
class_name TowerComponent extends Resource

@export var def_id: String = ""
@export var level: int = 1
@export var hex_q: int = 0
@export var hex_r: int = 0
@export var is_active: bool = false
@export var is_temporary: bool = true
@export var is_permanent: bool = false
@export var is_selected: bool = false
@export var tower_type: int = GameTypes.TowerType.ATTACK
```

```gdscript
# core/components/combat_component.gd
class_name CombatComponent extends Resource

@export var damage: int = 10
@export var fire_rate: float = 1.0
@export var range_radius: float = 3.0
@export var cooldown: float = 0.0
@export var attack_type: int = GameTypes.AttackType.PROJECTILE
@export var damage_type: int = GameTypes.DamageType.PHYSICAL
@export var shot_cost: float = 1.0
@export var split_count: int = 1
```

```gdscript
# core/components/health_component.gd
class_name HealthComponent extends Resource

@export var current: int = 100
@export var max_hp: int = 100

func is_alive() -> bool:
    return current > 0

func take_damage(amount: int) -> int:
    var actual = mini(amount, current)
    current -= actual
    return actual

func heal(amount: int):
    current = mini(current + amount, max_hp)
```

**–ü–æ—á–µ–º—É Resource, –∞ –Ω–µ RefCounted:**
- –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ (–¥–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –ø–∏—à–µ—à—å –∫–æ–¥–æ–º ‚Äî LSP –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç)
- –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å/–∑–∞–≥—Ä—É–∂–∞—Ç—å —á–µ—Ä–µ–∑ `ResourceSaver` –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è save/load
- –¢–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–≤–∏–∂–∫–∞

**ECS World —Ç–æ–≥–¥–∞:**
```gdscript
# core/ecs/ecs_world.gd
class_name ECSWorld

var next_id: int = 0
var entities: Array[int] = []

# –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
var positions: Dictionary = {}      # int -> Vector2
var towers: Dictionary = {}         # int -> TowerComponent
var combats: Dictionary = {}        # int -> CombatComponent
var healths: Dictionary = {}        # int -> HealthComponent
var enemies: Dictionary = {}        # int -> EnemyComponent
var projectiles: Dictionary = {}    # int -> ProjectileComponent
var paths: Dictionary = {}          # int -> PathComponent
var ores: Dictionary = {}           # int -> OreComponent
var energy_lines: Dictionary = {}   # int -> EnergyLineComponent
var renderables: Dictionary = {}    # int -> RenderableComponent

# –°–∏–Ω–≥–ª—Ç–æ–Ω-—Å–æ—Å—Ç–æ—è–Ω–∏–µ
var game_state: GameStateComponent = GameStateComponent.new()
var player_state: PlayerStateComponent = PlayerStateComponent.new()

func create_entity() -> int:
    var id = next_id
    next_id += 1
    entities.append(id)
    return id

func destroy_entity(id: int):
    positions.erase(id)
    towers.erase(id)
    combats.erase(id)
    healths.erase(id)
    enemies.erase(id)
    projectiles.erase(id)
    paths.erase(id)
    ores.erase(id)
    renderables.erase(id)
    entities.erase(id)

# –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚Äî –∫—ç—à–∏—Ä—É–µ–º—ã–µ
func get_active_towers() -> Array[int]:
    var result: Array[int] = []
    for id in towers:
        if towers[id].is_active:
            result.append(id)
    return result

func get_living_enemies() -> Array[int]:
    var result: Array[int] = []
    for id in enemies:
        if id in healths and healths[id].is_alive():
            result.append(id)
    return result
```

---

### 1.3. GameManager ‚Äî God Object

**–ü—Ä–æ–±–ª–µ–º–∞:** `GameManager` —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ—Ç –≤—Å—ë: –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Ö—Ä–∞–Ω–∏—Ç ECS, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä—É–¥—É, —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—É–∑–æ–π, —Ö—Ä–∞–Ω–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Å–æ–∑–¥–∞—ë—Ç —ç–Ω–µ—Ä–≥–æ—Å–µ—Ç—å. –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π God Object. –ö–æ–≥–¥–∞ –æ–Ω –≤—ã—Ä–∞—Å—Ç–µ—Ç –¥–æ 500+ —Å—Ç—Ä–æ–∫ ‚Äî —Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—à—å –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –≥–¥–µ.

**–†–µ—à–µ–Ω–∏–µ ‚Äî —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 3 autoload:**

```
autoload/
‚îú‚îÄ‚îÄ Config.gd           # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (—É–∂–µ –µ—Å—Ç—å, –æ–∫)
‚îú‚îÄ‚îÄ GameManager.gd      # –¢–æ–ª—å–∫–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è: init, pause, phase
‚îî‚îÄ‚îÄ DataRepository.gd   # –¢–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ: tower_defs, enemy_defs, wave_defs
```

```gdscript
# autoload/data_repository.gd
extends Node

var tower_defs: Dictionary = {}
var enemy_defs: Dictionary = {}
var wave_defs: Dictionary = {}
var recipe_defs: Array = []
var loot_tables: Dictionary = {}

func _ready():
    _load_all()

func _load_all():
    tower_defs = _load_and_index("res://data/towers.json", "id")
    enemy_defs = _load_and_index("res://data/enemies.json", "id")
    wave_defs = _load_and_index_by_number("res://data/waves.json")
    recipe_defs = Config.load_json("res://data/recipes.json")
    loot_tables = Config.load_json("res://data/loot_tables.json")

func get_tower_def(id: String) -> Dictionary:
    return tower_defs.get(id, {})

func get_enemy_def(id: String) -> Dictionary:
    return enemy_defs.get(id, {})

func get_wave_def(wave_number: int) -> Dictionary:
    # –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø–æ–≤—Ç–æ—Ä –ø–æ—Å–ª–µ 10
    if wave_number > 10:
        var cycled = 6 + ((wave_number - 6) % 5)
        return wave_defs.get(cycled, {})
    return wave_defs.get(wave_number, {})

func get_random_attack_tower_id() -> String:
    var attack_towers = tower_defs.values().filter(
        func(d): return d.get("type", "") == "ATTACK"
    )
    if attack_towers.is_empty():
        return "TA"
    return attack_towers.pick_random()["id"]

func _load_and_index(path: String, key: String) -> Dictionary:
    var raw = Config.load_json(path)
    var result = {}
    for item in raw:
        result[item[key]] = item
    return result

func _load_and_index_by_number(path: String) -> Dictionary:
    var raw = Config.load_json(path)
    var result = {}
    for item in raw:
        result[item["wave_number"]] = item
    return result
```

–¢–µ–ø–µ—Ä—å `GameManager` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–æ–Ω–∫–∏–º:
```gdscript
# autoload/game_manager.gd
extends Node

var ecs: ECSWorld
var hex_map: HexMap
var phase_controller: PhaseController
var energy_network: EnergyNetworkSystem

func _ready():
    ecs = ECSWorld.new()
    hex_map = HexMap.new()
    hex_map.generate(Config.MAP_RADIUS)
    
    energy_network = EnergyNetworkSystem.new(ecs, hex_map)
    phase_controller = PhaseController.new()
    phase_controller.ecs = ecs
    phase_controller.hex_map = hex_map
    phase_controller.energy_network = energy_network
    
    _create_player()
    _generate_initial_walls()
    OreGenerationSystem.generate(ecs, hex_map)

func toggle_pause():
    ecs.game_state.paused = not ecs.game_state.paused

func set_time_speed(speed: float):
    ecs.game_state.time_speed = speed
```

---

## 2. üü° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 2.1. Spatial Hashing –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ü–µ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** `CombatSystem` –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –¥–ª—è –∫–∞–∂–¥–æ–π –±–∞—à–Ω–∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –í–°–ï–• –≤—Ä–∞–≥–æ–≤, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ç–µ—Ö, –∫—Ç–æ –≤ —Ä–∞–¥–∏—É—Å–µ. –ü—Ä–∏ 50 –±–∞—à–Ω—è—Ö –∏ 100 –≤—Ä–∞–≥–∞—Ö ‚Äî —ç—Ç–æ 5000 –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä.

**–†–µ—à–µ–Ω–∏–µ:**

```gdscript
# core/utils/spatial_hash.gd
class_name SpatialHash

var cell_size: float
var cells: Dictionary = {}  # Vector2i -> Array[int]

func _init(p_cell_size: float = 60.0):
    cell_size = p_cell_size

func clear():
    cells.clear()

func _get_cell(pos: Vector2) -> Vector2i:
    return Vector2i(
        floori(pos.x / cell_size),
        floori(pos.y / cell_size)
    )

func insert(entity_id: int, pos: Vector2):
    var cell = _get_cell(pos)
    if cell not in cells:
        cells[cell] = []
    cells[cell].append(entity_id)

func query_radius(center: Vector2, radius: float) -> Array[int]:
    var result: Array[int] = []
    var min_cell = _get_cell(center - Vector2(radius, radius))
    var max_cell = _get_cell(center + Vector2(radius, radius))
    var radius_sq = radius * radius
    
    for cx in range(min_cell.x, max_cell.x + 1):
        for cy in range(min_cell.y, max_cell.y + 1):
            var cell = Vector2i(cx, cy)
            if cell in cells:
                for id in cells[cell]:
                    # –ü–æ–∑–∏—Ü–∏—é –±–µ—Ä—ë–º —Å–Ω–∞—Ä—É–∂–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
                    result.append(id)
    
    return result
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CombatSystem:**

```gdscript
# –í –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ update():
var enemy_grid = SpatialHash.new(Config.HEX_SIZE * 4)
for enemy_id in ecs.get_living_enemies():
    enemy_grid.insert(enemy_id, ecs.positions[enemy_id])

# –ü—Ä–∏ –ø–æ–∏—Å–∫–µ —Ü–µ–ª–µ–π –¥–ª—è –±–∞—à–Ω–∏:
var candidates = enemy_grid.query_radius(tower_pos, combat.range_radius)
# –î–∞–ª—å—à–µ —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ candidates, –∞ –Ω–µ –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤
```

### 2.2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ ECS

**–ü—Ä–æ–±–ª–µ–º–∞:** `get_living_enemies()` –∏ `get_active_towers()` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∑–∞ –∫–∞–¥—Ä, –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∏—Ç–µ—Ä–∏—Ä—É—è –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏.

```gdscript
# –í ECSWorld –¥–æ–±–∞–≤–∏—Ç—å:
var _cache_dirty: bool = true
var _cached_living_enemies: Array[int] = []
var _cached_active_towers: Array[int] = []

func mark_dirty():
    _cache_dirty = true

func get_living_enemies() -> Array[int]:
    if _cache_dirty:
        _rebuild_cache()
    return _cached_living_enemies

func get_active_towers() -> Array[int]:
    if _cache_dirty:
        _rebuild_cache()
    return _cached_active_towers

func _rebuild_cache():
    _cached_living_enemies.clear()
    for id in enemies:
        if id in healths and healths[id].is_alive():
            _cached_living_enemies.append(id)
    
    _cached_active_towers.clear()
    for id in towers:
        if towers[id].is_active:
            _cached_active_towers.append(id)
    
    _cache_dirty = false

# –í—ã–∑—ã–≤–∞—Ç—å mark_dirty() –ø—Ä–∏:
# - create_entity / destroy_entity
# - –∏–∑–º–µ–Ω–µ–Ω–∏–∏ health
# - –∏–∑–º–µ–Ω–µ–Ω–∏–∏ tower.is_active
```

### 2.3. Object Pool ‚Äî —Ç—ã —É–∂–µ –∑–∞–ª–æ–∂–∏–ª, –Ω–æ —Ñ–æ—Ä–º–∞–ª–∏–∑—É–π

```gdscript
# core/utils/node_pool.gd
class_name NodePool

var _scene: PackedScene
var _pool: Array[Node] = []
var _parent: Node
var _active_count: int = 0

func _init(scene: PackedScene, parent: Node, prealloc: int = 0):
    _scene = scene
    _parent = parent
    for i in prealloc:
        var node = _scene.instantiate()
        node.visible = false
        _parent.add_child(node)
        _pool.append(node)

func acquire() -> Node:
    var node: Node
    if _pool.size() > 0:
        node = _pool.pop_back()
    else:
        node = _scene.instantiate()
        _parent.add_child(node)
    node.visible = true
    _active_count += 1
    return node

func release(node: Node):
    node.visible = false
    # Reset state
    if node is Node2D:
        node.position = Vector2.ZERO
        node.rotation = 0
        node.scale = Vector2.ONE
    _pool.append(node)
    _active_count -= 1

func get_active_count() -> int:
    return _active_count
```

---

## 3. üü¢ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Å–æ–ª–æ-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### 3.1. Signal Bus ‚Äî –∑–∞–º–µ–Ω–∏ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–ª–∞ –æ –∫–∞–∂–¥–æ–π –¥—Ä—É–≥–æ–π, —Å–¥–µ–ª–∞–π –æ–¥–∏–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π —à–∏–Ω—É —Å–æ–±—ã—Ç–∏–π:

```gdscript
# autoload/event_bus.gd
extends Node

# –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
signal enemy_killed(enemy_id: int, position: Vector2)
signal enemy_reached_exit(enemy_id: int)
signal tower_placed(tower_id: int, hex_q: int, hex_r: int)
signal tower_removed(tower_id: int)
signal wave_started(wave_number: int)
signal wave_completed(wave_number: int)
signal phase_changed(old_phase: int, new_phase: int)
signal ore_depleted(ore_id: int)
signal player_damaged(amount: int, remaining: int)
signal player_level_up(new_level: int)

# UI —Å–æ–±—ã—Ç–∏—è
signal tower_selected(tower_id: int)
signal tower_deselected(tower_id: int)
signal show_info_panel(entity_id: int)
signal hide_info_panel()
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```gdscript
# –í CombatSystem –ø—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –≤—Ä–∞–≥–∞:
EventBus.enemy_killed.emit(enemy_id, ecs.positions[enemy_id])

# –í GameHUD ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞:
func _ready():
    EventBus.enemy_killed.connect(_on_enemy_killed)
    EventBus.phase_changed.connect(_on_phase_changed)

# –í —Å–∏—Å—Ç–µ–º–µ –æ–ø—ã—Ç–∞ (–∫–æ–≥–¥–∞ —Å–¥–µ–ª–∞–µ—à—å):
func _ready():
    EventBus.enemy_killed.connect(_on_enemy_killed)

func _on_enemy_killed(enemy_id: int, pos: Vector2):
    var xp = DataRepository.get_enemy_def(
        ecs.enemies[enemy_id].def_id
    ).get("xp_reward", 10)
    ecs.player_state.xp += xp
```

**–ó–∞—á–µ–º:** —Ç—ã —Å–æ–ª–æ, –∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è. –° Signal Bus —Ç—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—à—å—Å—è –≤ –Ω–æ–≤–æ–º –º–µ—Å—Ç–µ, –Ω–µ —Ç—Ä–æ–≥–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥.

### 3.2. –§–∞–±—Ä–∏–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π ‚Äî –Ω–µ —Ä–∞–∑–º–∞–∑—ã–≤–∞–π —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ —Å–∏—Å—Ç–µ–º–∞–º

```gdscript
# core/ecs/entity_factory.gd
class_name EntityFactory

static func create_tower(ecs: ECSWorld, hex: Vector2i, def_id: String) -> int:
    var def = DataRepository.get_tower_def(def_id)
    var id = ecs.create_entity()
    
    # Position
    var pixel_pos = Hex.to_pixel(hex.x, hex.y, Config.HEX_SIZE)
    ecs.positions[id] = pixel_pos
    
    # Tower component
    var tower = TowerComponent.new()
    tower.def_id = def_id
    tower.hex_q = hex.x
    tower.hex_r = hex.y
    tower.tower_type = GameTypes.string_to_tower_type(def.get("type", "ATTACK"))
    tower.is_temporary = true
    ecs.towers[id] = tower
    
    # Combat (–µ—Å–ª–∏ –∞—Ç–∞–∫—É—é—â–∞—è)
    if tower.tower_type == GameTypes.TowerType.ATTACK:
        var combat = CombatComponent.new()
        var combat_def = def.get("combat", {})
        combat.damage = combat_def.get("damage", 10)
        combat.fire_rate = combat_def.get("fire_rate", 1.0)
        combat.range_radius = combat_def.get("range", 3.0) * Config.HEX_SIZE
        combat.attack_type = GameTypes.string_to_attack_type(
            combat_def.get("attack", "PROJECTILE")
        )
        combat.damage_type = GameTypes.string_to_damage_type(
            combat_def.get("damage_type", "PHYSICAL")
        )
        combat.shot_cost = combat_def.get("shot_cost", 1.0)
        combat.split_count = combat_def.get("split_count", 1)
        ecs.combats[id] = combat
    
    # Renderable
    var renderable = RenderableComponent.new()
    var visuals = def.get("visuals", {})
    renderable.color = Color(visuals.get("color", "#FF8C00"))
    renderable.radius_factor = visuals.get("radius_factor", 1.0)
    ecs.renderables[id] = renderable
    
    return id

static func create_enemy(ecs: ECSWorld, def_id: String, path_hexes: Array) -> int:
    var def = DataRepository.get_enemy_def(def_id)
    var id = ecs.create_entity()
    
    # Position ‚Äî –Ω–∞ Entry
    var start_hex = path_hexes[0]
    ecs.positions[id] = Hex.to_pixel(start_hex.x, start_hex.y, Config.HEX_SIZE)
    
    # Health
    var health = HealthComponent.new()
    health.max_hp = def.get("health", 100)
    health.current = health.max_hp
    ecs.healths[id] = health
    
    # Enemy
    var enemy = EnemyComponent.new()
    enemy.def_id = def_id
    enemy.physical_armor = def.get("physical_armor", 0)
    enemy.magical_armor = def.get("magical_armor", 0)
    enemy.base_speed = def.get("speed", 80.0)
    ecs.enemies[id] = enemy
    
    # Path
    var path = PathComponent.new()
    path.hexes = path_hexes
    path.current_index = 0
    ecs.paths[id] = path
    
    # Renderable
    var renderable = RenderableComponent.new()
    renderable.color = Color(def.get("color", "#FF0000"))
    ecs.renderables[id] = renderable
    
    return id

static func create_projectile(
    ecs: ECSWorld, 
    source_id: int, 
    target_id: int, 
    damage: int,
    damage_type: int,
    start_pos: Vector2
) -> int:
    var id = ecs.create_entity()
    
    ecs.positions[id] = start_pos
    
    var proj = ProjectileComponent.new()
    proj.source_id = source_id
    proj.target_id = target_id
    proj.damage = damage
    proj.damage_type = damage_type
    proj.speed = Config.PROJECTILE_SPEED
    ecs.projectiles[id] = proj
    
    var renderable = RenderableComponent.new()
    renderable.color = GameTypes.get_damage_type_color(damage_type)
    renderable.radius_factor = 0.3
    ecs.renderables[id] = renderable
    
    return id
```

**–ó–∞—á–µ–º:** —Å–µ–π—á–∞—Å —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞—à–Ω–∏/–≤—Ä–∞–≥–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–æ –ø–æ `InputSystem`, `WaveSystem`, –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –¥—Ä—É–≥–∏–º –º–µ—Å—Ç–∞–º. –° —Ñ–∞–±—Ä–∏–∫–æ–π ‚Äî –æ–¥–Ω–æ –º–µ—Å—Ç–æ, –æ–¥–Ω–∞ –ø—Ä–∞–≤–¥–∞.

### 3.3. –°–∏—Å—Ç–µ–º–∞ –¥–µ–±–∞–≥–∞ ‚Äî —Ç—ã —É–∂–µ –∑–∞–ª–æ–∂–∏–ª, —É—Å–∏–ª—å

```gdscript
# autoload/debug_console.gd (–∏–ª–∏ –≤ Config)
extends Node

var _log_enabled: bool = true
var _log_categories: Dictionary = {
    "combat": false,
    "wave": true,
    "energy": false,
    "phase": true,
    "input": false,
}

func log(category: String, message: String):
    if _log_enabled and _log_categories.get(category, false):
        print("[%s][%.2f] %s" % [
            category.to_upper(), 
            Time.get_ticks_msec() / 1000.0,
            message
        ])

func toggle_category(category: String):
    _log_categories[category] = not _log_categories.get(category, false)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
# DebugConsole.log("combat", "Tower %d hit enemy %d for %d damage" % [t, e, dmg])
# DebugConsole.log("wave", "Wave %d started, %d enemies" % [num, count])
```

---

## 4. üîµ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

```
tanabata-godot/
‚îú‚îÄ‚îÄ autoload/
‚îÇ   ‚îú‚îÄ‚îÄ config.gd              # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ game_manager.gd        # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (—Ç–æ–Ω–∫–∏–π)
‚îÇ   ‚îú‚îÄ‚îÄ data_repository.gd     # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îî‚îÄ‚îÄ event_bus.gd           # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
‚îÇ
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ ecs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecs_world.gd       # –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entity_factory.gd  # –°–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/             # –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Resource-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tower_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ combat_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enemy_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ path_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projectile_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ore_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ energy_line_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ renderable_component.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game_state_component.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ player_state_component.gd
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ systems/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phase_controller.gd    # ‚Üê –ù–û–í–´–ô: –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wave_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ movement_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ combat_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projectile_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status_effect_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aura_system.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ energy_network_system.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ore_generation_system.gd
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hexmap/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hex.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hex_map.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pathfinding.gd
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ game_types.gd
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ union_find.gd
‚îÇ       ‚îú‚îÄ‚îÄ spatial_hash.gd     # ‚Üê –ù–û–í–´–ô
‚îÇ       ‚îî‚îÄ‚îÄ node_pool.gd
‚îÇ
‚îú‚îÄ‚îÄ godot_adapter/
‚îÇ   ‚îú‚îÄ‚îÄ rendering/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity_renderer.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wall_renderer.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ore_renderer.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ energy_line_renderer.gd
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aura_renderer.gd
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tower_preview.gd
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ       ‚îú‚îÄ‚îÄ game_hud.gd
‚îÇ       ‚îî‚îÄ‚îÄ info_panel.gd
‚îÇ
‚îú‚îÄ‚îÄ scenes/
‚îÇ   ‚îú‚îÄ‚îÄ main.tscn / main.gd
‚îÇ   ‚îî‚îÄ‚îÄ game_root.tscn / game_root.gd
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ towers.json
‚îÇ   ‚îú‚îÄ‚îÄ enemies.json
‚îÇ   ‚îú‚îÄ‚îÄ waves.json
‚îÇ   ‚îú‚îÄ‚îÄ recipes.json
‚îÇ   ‚îî‚îÄ‚îÄ loot_tables.json
‚îÇ
‚îî‚îÄ‚îÄ project.godot
```

---

## 5. üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

–¢—ã —Å–æ–ª–æ, –ø–æ—ç—Ç–æ–º—É –ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω. –ù–µ –¥–µ–ª–∞–π –≤—Å—ë —Å—Ä–∞–∑—É.

### –ù–µ–¥–µ–ª—è 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç (–±–µ–∑ –Ω–æ–≤–æ–≥–æ –≥–µ–π–º–ø–ª–µ—è)
| # | –ó–∞–¥–∞—á–∞ | –ó–∞—á–µ–º |
|---|--------|-------|
| 1 | –°–æ–∑–¥–∞—Ç—å Resource-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (tower, combat, health, enemy, path, projectile) | –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤ |
| 2 | –°–æ–∑–¥–∞—Ç—å `EntityFactory` | –û–¥–Ω–æ –º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π |
| 3 | –°–æ–∑–¥–∞—Ç—å `PhaseController` | –£–±—Ä–∞—Ç—å –ª–æ–≥–∏–∫—É —Ñ–∞–∑ –∏–∑ UI |
| 4 | –°–æ–∑–¥–∞—Ç—å `EventBus` autoload | –†–∞–∑–≤—è–∑–∫–∞ —Å–∏—Å—Ç–µ–º |
| 5 | –í—ã–Ω–µ—Å—Ç–∏ `DataRepository` –∏–∑ GameManager | –¢–æ–Ω–∫–∏–π GameManager |

### –ù–µ–¥–µ–ª—è 2: MVP –≥–µ–π–º–ø–ª–µ–π
| # | –ó–∞–¥–∞—á–∞ |
|---|--------|
| 6 | `WaveSystem` ‚Äî —Å–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤ —á–µ—Ä–µ–∑ EntityFactory |
| 7 | `MovementSystem` ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ path |
| 8 | `CombatSystem` ‚Äî –ø–æ–∏—Å–∫ —Ü–µ–ª–µ–π, —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–æ–≤ |
| 9 | `ProjectileSystem` ‚Äî –ø–æ–ª—ë—Ç –∏ –ø–æ–ø–∞–¥–∞–Ω–∏–µ |
| 10 | `EntityRenderer` ‚Äî –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ–≥–æ (placeholder-—ã) |

### –ù–µ–¥–µ–ª—è 3: –≠–Ω–µ—Ä–≥–æ—Å–µ—Ç—å + —Ä—É–¥–∞
| # | –ó–∞–¥–∞—á–∞ |
|---|--------|
| 11 | `OreGenerationSystem` |
| 12 | `EnergyNetworkSystem` (MST, —Å–≤—è–∑–∏) |
| 13 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –≤ CombatSystem |
| 14 | `EnergyLineRenderer` + `OreRenderer` |

### –ù–µ–¥–µ–ª—è 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ MVP
| # | –ó–∞–¥–∞—á–∞ |
|---|--------|
| 15 | `SpatialHash` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ü–µ–ª–µ–π |
| 16 | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ ECS |
| 17 | HUD (–∑–¥–æ—Ä–æ–≤—å–µ, –≤–æ–ª–Ω–∞, —Ñ–∞–∑–∞) |
| 18 | –°—Ç–∞—Ç—É—Å-—ç—Ñ—Ñ–µ–∫—Ç—ã (slow, poison) |

---

## 6. ‚ö†Ô∏è –ß–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å (–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Å–æ–ª–æ)

| ‚ùå –ù–µ –¥–µ–ª–∞–π | ‚úÖ –î–µ–ª–∞–π –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ |
|------------|----------------------|
| –ù–µ –ø–∏—à–∏ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ | –ü–∏—à–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: –∑–∞–ø—É—Å—Ç–∏ –≤–æ–ª–Ω—É, –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤—Ä–∞–≥–∏ —É–º–∏—Ä–∞—é—Ç |
| –ù–µ –¥–µ–ª–∞–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã "–Ω–∞ –±—É–¥—É—â–µ–µ" | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏ –∫–æ–≥–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ (YAGNI) |
| –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —Ä–µ–Ω–¥–µ—Ä –¥–æ 100+ –≤—Ä–∞–≥–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ | –°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π —á—Ç–æ–±—ã 20 —Ä–∞–±–æ—Ç–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ |
| –ù–µ —Ç—Ä–æ–≥–∞–π –≤–∏–∑—É–∞–ª (—à–µ–π–¥–µ—Ä—ã, —á–∞—Å—Ç–∏—Ü—ã) –¥–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –≥–µ–π–º–ø–ª–µ—è | Placeholder-—ã ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ |
| –ù–µ –¥–µ–ª–∞–π save/load –¥–æ –ø–æ–ª–Ω–æ–≥–æ MVP | –≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–æ–ª—å—à–∞—è –∑–∞–¥–∞—á–∞ |
| –ù–µ –¥–µ–ª–∞–π –º–µ–Ω—é/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ –ø–æ–ª–Ω–æ–≥–æ MVP | F-–∫–ª–∞–≤–∏—à–∏ –¥–ª—è –¥–µ–±–∞–≥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |

---

## 7. üí° –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ Godot –¥–ª—è "–∫–æ–¥–µ—Ä–∞ –±–µ–∑ GUI"

–†–∞–∑ —Ç—ã –Ω–µ–Ω–∞–≤–∏–¥–∏—à—å GUI –¥–≤–∏–∂–∫–∞ –∏ –ø–∏—à–µ—à—å –≤—Å—ë –∫–æ–¥–æ–º:

### 7.1. –°–æ–∑–¥–∞–≤–∞–π —Å—Ü–µ–Ω—ã –∫–æ–¥–æ–º
```gdscript
# –í game_root.gd _ready():
func _setup_layers():
    var hex_layer = Node2D.new()
    hex_layer.name = "HexLayer"
    hex_layer.z_index = 0
    add_child(hex_layer)
    
    var tower_layer = Node2D.new()
    tower_layer.name = "TowerLayer"
    tower_layer.z_index = 10
    add_child(tower_layer)
    
    # ... –∏ —Ç.–¥.
```

### 7.2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π .tscn
–¢–µ–±–µ –Ω—É–∂–Ω–æ –±—É–∫–≤–∞–ª—å–Ω–æ 2 —Ñ–∞–π–ª–∞ .tscn:
- `main.tscn` ‚Äî –ø—É—Å—Ç–∞—è —Å—Ü–µ–Ω–∞ —Å –æ–¥–Ω–∏–º Node –∏ —Å–∫—Ä–∏–ø—Ç–æ–º
- `game_root.tscn` ‚Äî –ø—É—Å—Ç–∞—è —Å—Ü–µ–Ω–∞ —Å Node2D –∏ —Å–∫—Ä–∏–ø—Ç–æ–º

–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –∫–æ–¥–æ–º. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

### 7.3. –ò—Å–ø–æ–ª—å–∑—É–π `@tool` –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –¥–µ–±–∞–≥–∞
```gdscript
@tool
extends Node2D

func _draw():
    if Engine.is_editor_hint():
        # –†–∏—Å—É–π –≥–µ–∫—Å—ã –ø—Ä—è–º–æ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        draw_circle(Vector2.ZERO, 10, Color.RED)
```

### 7.4. –ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
```gdscript
# –í game_root.gd:
func _input(event):
    if event.is_action_pressed("ui_home"):  # Home key
        get_tree().reload_current_scene()
```

---

## –ò—Ç–æ–≥–æ

–¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –Ω–µ–ø–ª–æ—Ö–æ–π. –ì–ª–∞–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–õ–æ–≥–∏–∫–∞ —Ñ–∞–∑ —Ä–∞–∑–º–∞–∑–∞–Ω–∞** ‚Üí `PhaseController`
2. **–°–ª–æ–≤–∞—Ä–∏ –±–µ–∑ —Ç–∏–ø–æ–≤** ‚Üí `Resource`-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
3. **GameManager ‚Äî God Object** ‚Üí —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 3
4. **–ù–µ—Ç –µ–¥–∏–Ω–æ–π —à–∏–Ω—ã —Å–æ–±—ã—Ç–∏–π** ‚Üí `EventBus`
5. **–ù–µ—Ç —Ñ–∞–±—Ä–∏–∫–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π** ‚Üí `EntityFactory`
6. **–ü–æ–∏—Å–∫ —Ü–µ–ª–µ–π O(n*m)** ‚Üí `SpatialHash`

–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ, –ø–æ –ø–ª–∞–Ω—É. –¢—ã mid+ Python —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, GDScript –¥–ª—è —Ç–µ–±—è –±—É–¥–µ—Ç –∫–∞–∫ –¥–æ–º–∞. –£–¥–∞—á–∏, –±—Ä–æ üí™


–ë—Ä–æ, 10000+ —Å—É—â–Ω–æ—Å—Ç–µ–π + –æ–Ω–ª–∞–π–Ω + —Å–ª–æ–∂–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è ‚Äî —ç—Ç–æ –º–µ–Ω—è–µ—Ç –≤–æ–æ–±—â–µ –≤—Å—ë. –î–∞–≤–∞–π —á–µ—Å—Ç–Ω–æ –∏ –ø–æ –¥–µ–ª—É.

---

# –ñ—ë—Å—Ç–∫–∞—è –ø—Ä–∞–≤–¥–∞: GDScript –Ω–µ –ø–æ—Ç—è–Ω–µ—Ç

## –ü–æ—á–µ–º—É

GDScript ‚Äî –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–π —è–∑—ã–∫. –ù–∞ 500 —Å—É—â–Ω–æ—Å—Ç—è—Ö —Ç—ã –Ω–∞—á–Ω—ë—à—å –æ—â—É—â–∞—Ç—å –ø—Ä–æ—Å–∞–¥–∫–∏, –Ω–∞ 2000 ‚Äî –±—É–¥–µ—Ç –±–æ–ª—å–Ω–æ, 10000 ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –ö–∞–∂–¥—ã–π –∫–∞–¥—Ä –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å 10000 —Å–ª–æ–≤–∞—Ä–µ–π –≤ GDScript ‚Äî —ç—Ç–æ —Å–º–µ—Ä—Ç—å.

**–¢–≤–æ–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–æ—Ç –ª—É—á—à–µ–≥–æ –∫ —Ö—É–¥—à–µ–º—É):**

| –í–∞—Ä–∏–∞–Ω—Ç | 10K —Å—É—â–Ω–æ—Å—Ç–µ–π | –û–Ω–ª–∞–π–Ω | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –î–ª—è —Ç–µ–±—è |
|---------|--------------|--------|-----------|----------|
| **Godot + GDExtension (C++)** | –î–∞ | –î–∞ | –í—ã—Å–æ–∫–∞—è | –¢—ã —Å Go, C++ –æ—Å–≤–æ–∏—à—å |
| **Godot + C#** | 5-8K | –î–∞ | –°—Ä–µ–¥–Ω—è—è | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç |
| **–°–≤–æ–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ Go + Godot –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç** | –î–∞ | –î–∞ | –°—Ä–µ–¥–Ω—è—è | –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è |
| **–ß–∏—Å—Ç—ã–π GDScript** | 500-1000 –º–∞–∫—Å | –ë–æ–ª—å–Ω–æ | –ù–∏–∑–∫–∞—è | –ù–µ –¥–ª—è —Ç–≤–æ–∏—Ö —Ü–µ–ª–µ–π |

## –ú–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –≥–∏–±—Ä–∏–¥

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –ê–†–•–ò–¢–ï–ö–¢–£–†–ê                     ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  Go —Å–µ—Ä–≤–µ—Ä (–∞–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ ECS (–≤—Å—è —Å–∏–º—É–ª—è—Ü–∏—è)                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –≠–Ω–µ—Ä–≥–æ—Å–µ—Ç—å, –±–æ–π, –≤–æ–ª–Ω—ã, —ç—Ñ—Ñ–µ–∫—Ç—ã        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –°–µ—Ç–µ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª (WebSocket/UDP)       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–∞              ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  Godot –∫–ª–∏–µ–Ω—Ç (—Ç—É–ø–æ–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä)              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –†–µ–Ω–¥–µ—Ä–∏—Ç                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏–≥—Ä–æ–∫–∞              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è/–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ UI, —ç—Ñ—Ñ–µ–∫—Ç—ã, –∑–≤—É–∫                      ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  GDExtension (C++) ‚Äî –≥–æ—Ä—è—á–∏–µ –ø—É—Ç–∏           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Spatial Hash –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –ë–∞—Ç—á-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ 10K —Å–ø—Ä–∞–π—Ç–æ–≤            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è:**
- –¢—ã —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª ECS –Ω–∞ Go ‚Äî –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–π
- Go —Å–µ—Ä–≤–µ—Ä = –∞–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- Godot = —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä (—Ç—ã —Å–∞–º —Å–∫–∞–∑–∞–ª —á—Ç–æ —Ç–∞–∫ —Ö–æ—á–µ—à—å)
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π

---

# –°–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±–µ –Ω—É–∂–Ω—ã

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥ (Command Pattern + CQRS)

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –æ–Ω–ª–∞–π–Ω–∞ –∏ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã –∫–æ–¥–∞.

**–°—É—Ç—å:** –∏–≥—Ä–æ–∫ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é. –û–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É. –°–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç.

```
–ò–≥—Ä–æ–∫ –∫–ª–∏–∫–Ω—É–ª "–ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–∞—à–Ω—é"
    ‚Üí Command { type: PLACE_TOWER, hex: {3,5}, tower_id: "TA" }
        ‚Üí –°–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç (—Ñ–∞–∑–∞? –ª–∏–º–∏—Ç? –≥–µ–∫—Å —Å–≤–æ–±–æ–¥–µ–Ω?)
            ‚Üí –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫ ECS
                ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç StateUpdate –∫–ª–∏–µ–Ω—Ç—É
                    ‚Üí –ö–ª–∏–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç
```

```gdscript
# –ö–ª–∏–µ–Ω—Ç ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥
class_name CommandSender

enum CommandType {
    PLACE_TOWER,
    REMOVE_TOWER,
    SELECT_TOWER,
    START_WAVE,
    CHANGE_PHASE,
    PAUSE,
}

# –õ–æ–∫–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ–º —Å—Ä–∞–∑—É
# –û–Ω–ª–∞–π–Ω ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
func send(cmd: Dictionary):
    if is_online:
        network.send_command(cmd)
    else:
        local_simulation.execute_command(cmd)
```

```go
// –°–µ—Ä–≤–µ—Ä –Ω–∞ Go ‚Äî –ø—Ä–∏—ë–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
type Command struct {
    Type      CommandType `json:"type"`
    PlayerID  int         `json:"player_id"`
    HexQ      int         `json:"hex_q,omitempty"`
    HexR      int         `json:"hex_r,omitempty"`
    TowerID   string      `json:"tower_id,omitempty"`
    Timestamp int64       `json:"timestamp"`
}

func (g *Game) ExecuteCommand(cmd Command) error {
    switch cmd.Type {
    case CmdPlaceTower:
        return g.validateAndPlaceTower(cmd)
    case CmdRemoveTower:
        return g.validateAndRemoveTower(cmd)
    // ...
    }
}
```

**–ó–∞—á–µ–º —Ç–µ–±–µ —ç—Ç–æ —Å–µ–π—á–∞—Å:** –¥–∞–∂–µ –±–µ–∑ –æ–Ω–ª–∞–π–Ω–∞ ‚Äî replay, undo, –¥–µ–±–∞–≥, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º. –ü–æ—Ç–æ–º –æ–Ω–ª–∞–π–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–º–µ–Ω–æ–π –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

---

## 2. Data-Oriented Design (DOD) ‚Äî –Ω–µ –ø—É—Ç–∞—Ç—å —Å ECS

ECS ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω. DOD ‚Äî —ç—Ç–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è. –¢–µ–±–µ –Ω—É–∂–Ω–∞ –∏–º–µ–Ω–Ω–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è.

**–ü—Ä–∏–Ω—Ü–∏–ø:** –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ –ø–ª–æ—Å–∫–∏—Ö –º–∞—Å—Å–∏–≤–∞—Ö, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ, –±–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.

```go
// –ü–õ–û–•–û ‚Äî Object-Oriented
type Enemy struct {
    Position  Vector2
    Health    int
    Speed     float64
    Armor     int
    Path      []Hex
    Effects   []StatusEffect  // —É–∫–∞–∑–∞—Ç–µ–ª—å, –∞–ª–ª–æ–∫–∞—Ü–∏—è
    // ...
}
enemies := []*Enemy{...}  // –º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π = cache miss

// –•–û–†–û–®–û ‚Äî Data-Oriented
type Positions struct {
    X []float32
    Y []float32
}
type Healths struct {
    Current []int32
    Max     []int32
}
type Speeds struct {
    Base    []float32
    Current []float32
}
// –õ–∏–Ω–µ–π–Ω—ã–π –æ–±—Ö–æ–¥ = –∫—ç—à CPU —Å—á–∞—Å—Ç–ª–∏–≤
for i := 0; i < count; i++ {
    positions.X[i] += velocities.X[i] * delta
    positions.Y[i] += velocities.Y[i] * delta
}
```

**–ù–∞ 10000 —Å—É—â–Ω–æ—Å—Ç–µ–π —Ä–∞–∑–Ω–∏—Ü–∞:**
- OOP —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏: ~15-30ms –Ω–∞ –∫–∞–¥—Ä
- DOD —Å –ø–ª–æ—Å–∫–∏–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏: ~0.5-2ms –Ω–∞ –∫–∞–¥—Ä

---

## 3. Spatial Partitioning ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

–ë–µ–∑ —ç—Ç–æ–≥–æ 10000 —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã. –¢–µ–±–µ –Ω—É–∂–Ω—ã –î–í–ï —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

### Spatial Hash Grid (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π)

```go
// –°–µ—Ä–≤–µ—Ä
type SpatialGrid struct {
    CellSize float32
    Cells    map[CellKey][]EntityID
}

// –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä (–¥—ë—à–µ–≤–æ)
func (g *SpatialGrid) Rebuild(positions *Positions, count int) {
    // clear all cells
    for k := range g.Cells {
        g.Cells[k] = g.Cells[k][:0]
    }
    for i := 0; i < count; i++ {
        key := CellKey{
            X: int(positions.X[i] / g.CellSize),
            Y: int(positions.Y[i] / g.CellSize),
        }
        g.Cells[key] = append(g.Cells[key], EntityID(i))
    }
}

// –ó–∞–ø—Ä–æ—Å: –≤—Å–µ –≤—Ä–∞–≥–∏ –≤ —Ä–∞–¥–∏—É—Å–µ
func (g *SpatialGrid) QueryRadius(cx, cy, radius float32) []EntityID {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ 9-25 —è—á–µ–µ–∫ –≤–º–µ—Å—Ç–æ 10000 —Å—É—â–Ω–æ—Å—Ç–µ–π
}
```

### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ç–∫–∞ (–¥–ª—è –±–∞—à–µ–Ω, —Å—Ç–µ–Ω, —Ä—É–¥—ã)

```go
// –ë–∞—à–Ω–∏ –Ω–µ –¥–≤–∏–≥–∞—é—Ç—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –º–∞—Å—Å–∏–≤ –ø–æ –≥–µ–∫—Å–∞–º
type TowerGrid struct {
    Towers map[HexKey]EntityID  // O(1) lookup
}
```

**–ë–µ–∑ —ç—Ç–æ–≥–æ:**
- 50 –±–∞—à–µ–Ω √ó 10000 –≤—Ä–∞–≥–æ–≤ = 500,000 –ø—Ä–æ–≤–µ—Ä–æ–∫/–∫–∞–¥—Ä
  
**–° —ç—Ç–∏–º:**
- 50 –±–∞—à–µ–Ω √ó ~20 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ = 1,000 –ø—Ä–æ–≤–µ—Ä–æ–∫/–∫–∞–¥—Ä

---

## 4. Dirty Flag + Reactive Systems

**–ü—Ä–æ–±–ª–µ–º–∞:** —ç–Ω–µ—Ä–≥–æ—Å–µ—Ç—å, –∞—É—Ä—ã, –ø—É—Ç–∏ ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –¥–æ—Ä–æ–≥–æ, –∞ –º–µ–Ω—è—é—Ç—Å—è –æ–Ω–∏ —Ä–µ–¥–∫–æ.

```go
type DirtyFlags struct {
    EnergyNetwork bool
    Pathfinding   bool
    AuraZones     bool
    TowerRanges   bool
}

// –°—Ç–∞–≤–∏—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
func (g *Game) PlaceTower(cmd Command) {
    // ... —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞—à–Ω–∏ ...
    g.Dirty.EnergyNetwork = true
    g.Dirty.Pathfinding = true
    g.Dirty.AuraZones = true
}

// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–¥—Ä–∞
func (g *Game) Update(delta float64) {
    if g.Dirty.EnergyNetwork {
        g.energySystem.Rebuild()
        g.Dirty.EnergyNetwork = false
    }
    if g.Dirty.Pathfinding {
        g.pathCache.Invalidate()
        g.Dirty.Pathfinding = false
    }
    // –î–≤–∏–∂–µ–Ω–∏–µ –∏ –±–æ–π ‚Äî –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä (–¥–µ—à—ë–≤—ã–µ —Å DOD)
    g.movementSystem.Update(delta)
    g.combatSystem.Update(delta)
}
```

---

## 5. Effect System (Composition over Inheritance)

–£ —Ç–µ–±—è –∫—É—á–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤: slow, poison, jade poison, aura speed, damage boost, ore bonus. –≠—Ç–æ –±—É–¥–µ—Ç —Ä–∞—Å—Ç–∏. –ù–µ –¥–µ–ª–∞–π –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π —ç—Ñ—Ñ–µ–∫—Ç.

```go
type EffectType int
const (
    EffectSlow EffectType = iota
    EffectPoison
    EffectDamageBoost
    EffectSpeedAura
    EffectArmorReduce
    // –î–æ–±–∞–≤–ª—è–π —Å–∫–æ–ª—å–∫–æ —Ö–æ—á–µ—à—å
)

type Effect struct {
    Type       EffectType
    Value      float32    // —Å–∏–ª–∞ —ç—Ñ—Ñ–µ–∫—Ç–∞
    Duration   float32    // –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è (-1 = –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ)
    SourceID   EntityID   // –∫—Ç–æ –Ω–∞–ª–æ–∂–∏–ª
    StackCount int        // —Å—Ç–∞–∫–∏
    MaxStacks  int
}

// –í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —Å—É—â–Ω–æ—Å—Ç–∏ ‚Äî –ø–ª–æ—Å–∫–∏–π –º–∞—Å—Å–∏–≤
type EffectContainer struct {
    Effects [MaxEffectsPerEntity]Effect
    Count   int
}

// –û–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —ç—Ñ—Ñ–µ–∫—Ç—ã
type EffectSystem struct{}

func (s *EffectSystem) Update(delta float64, ecs *ECS) {
    for i := 0; i < ecs.EntityCount; i++ {
        container := &ecs.Effects[i]
        
        // –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
        speedMult := 1.0
        poisonDPS := 0.0
        
        alive := 0
        for j := 0; j < container.Count; j++ {
            e := &container.Effects[j]
            e.Duration -= float32(delta)
            
            if e.Duration > 0 || e.Duration == -1 {
                switch e.Type {
                case EffectSlow:
                    speedMult *= (1.0 - float64(e.Value))
                case EffectPoison:
                    poisonDPS += float64(e.Value) * float64(e.StackCount)
                case EffectArmorReduce:
                    // ...
                }
                container.Effects[alive] = *e
                alive++
            }
        }
        container.Count = alive
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º
        ecs.Speeds.Current[i] = ecs.Speeds.Base[i] * float32(speedMult)
        if poisonDPS > 0 {
            ecs.Healths.Current[i] -= int32(poisonDPS * delta)
        }
    }
}
```

**–ó–∞—á–µ–º:** –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç = –¥–æ–±–∞–≤–∏—Ç—å `const` + `case` –≤ switch. –ù–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª, –Ω–µ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –Ω–µ –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.

---

## 6. Event Sourcing (–ª—ë–≥–∫–∞—è –≤–µ—Ä—Å–∏—è)

–í—Å–µ –∑–Ω–∞—á–∏–º—ã–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è. –≠—Ç–æ –¥–∞—ë—Ç —Ç–µ–±–µ replay, –¥–µ–±–∞–≥, –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –æ—Å–Ω–æ–≤—É –¥–ª—è –æ–Ω–ª–∞–π–Ω–∞.

```go
type GameEvent struct {
    Tick      uint64
    Type      EventType
    EntityA   EntityID
    EntityB   EntityID
    ValueI    int32
    ValueF    float32
    HexQ, HexR int16
}

type EventLog struct {
    Events []GameEvent
    // –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –¥–ª—è —Å–µ—Ç–∏
}

func (log *EventLog) Record(e GameEvent) {
    log.Events = append(log.Events, e)
}

// –ü—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –≤—Ä–∞–≥–∞:
eventLog.Record(GameEvent{
    Tick:    currentTick,
    Type:    EventEnemyKilled,
    EntityA: towerID,
    EntityB: enemyID,
    ValueI:  damage,
})
```

---

## 7. Network Layer (–∫–æ–≥–¥–∞ –¥–æ–π–¥—ë—à—å –¥–æ –æ–Ω–ª–∞–π–Ω–∞)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –∞–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     Commands      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Client  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  ‚îÇ  Server  ‚îÇ
‚îÇ (Godot)  ‚îÇ                   ‚îÇ  (Go)    ‚îÇ
‚îÇ          ‚îÇ  ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ          ‚îÇ
‚îÇ  Render  ‚îÇ   State Snapshots ‚îÇ  ECS     ‚îÇ
‚îÇ  UI      ‚îÇ   + Events        ‚îÇ  Logic   ‚îÇ
‚îÇ  Input   ‚îÇ                   ‚îÇ  Auth    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ—Ç–æ–∫–æ–ª: Delta Compression

```go
// –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π 10000 –ø–æ–∑–∏—Ü–∏–π –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
// –û—Ç–ø—Ä–∞–≤–ª—è–π —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

type StateSnapshot struct {
    Tick           uint64
    ChangedEntities []EntityDelta
    NewEntities     []EntityFull
    DeadEntities    []EntityID
    Events          []GameEvent
}

type EntityDelta struct {
    ID    EntityID
    Flags uint16    // –±–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞: —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
    PosX  int16     // –µ—Å–ª–∏ Flags & POS_CHANGED
    PosY  int16
    HP    int16     // –µ—Å–ª–∏ Flags & HP_CHANGED
}
```

### Tick Rate

```go
const (
    ServerTickRate = 20   // 20 —Ç–∏–∫–æ–≤/—Å–µ–∫ –¥–ª—è –ª–æ–≥–∏–∫–∏
    ClientFPS     = 60    // 60 –∫–∞–¥—Ä–æ–≤/—Å–µ–∫ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞
    // –ö–ª–∏–µ–Ω—Ç –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ—Ç –º–µ–∂–¥—É —Ç–∏–∫–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞
)
```

---

## 8. Rendering Pipeline (Godot —Å—Ç–æ—Ä–æ–Ω–∞)

–î–ª—è 10000 —Å–ø—Ä–∞–π—Ç–æ–≤ –æ–±—ã—á–Ω—ã–µ Node2D/Sprite2D ‚Äî —Å–º–µ—Ä—Ç—å. –¢–µ–±–µ –Ω—É–∂–µ–Ω **MultiMeshInstance2D**.

```gdscript
# godot_adapter/rendering/batch_renderer.gd
extends MultiMeshInstance2D

var entity_count: int = 0

func _ready():
    multimesh = MultiMesh.new()
    multimesh.transform_format = MultiMesh.TRANSFORM_2D
    multimesh.use_colors = true
    multimesh.instance_count = 0  # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    multimesh.visible_instance_count = 0
    multimesh.mesh = _create_quad_mesh()

func update_from_snapshot(snapshot: Dictionary):
    var positions: PackedFloat32Array = snapshot["positions"]
    var colors: PackedColorArray = snapshot["colors"]
    var count = positions.size() / 2
    
    if count > multimesh.instance_count:
        multimesh.instance_count = count + 1000  # —Å –∑–∞–ø–∞—Å–æ–º
    multimesh.visible_instance_count = count
    
    for i in count:
        var t = Transform2D()
        t.origin = Vector2(positions[i * 2], positions[i * 2 + 1])
        multimesh.set_instance_transform_2d(i, t)
        multimesh.set_instance_color(i, colors[i])
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 10000 –≤—Ä–∞–≥–æ–≤ = 1 draw call. –í–º–µ—Å—Ç–æ 10000 –Ω–æ–¥.

---

## –û–±—â–∏–π –ø–ª–∞–Ω (–ø–æ —ç—Ç–∞–ø–∞–º)

```
–≠–¢–ê–ü 0 (—Å–µ–π—á–∞—Å): –û–ø—Ä–µ–¥–µ–ª–∏—Å—å —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
‚îú‚îÄ‚îÄ –†–µ—à–µ–Ω–∏–µ: Go —Å–µ—Ä–≤–µ—Ä + Godot –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ –ò–ª–∏: –≤—Å—ë –≤ Godot, –Ω–æ –≥–æ—Ä—è—á–∏–µ –ø—É—Ç–∏ –Ω–∞ GDExtension (C++)
‚îî‚îÄ‚îÄ –ò–ª–∏: –≤—Å—ë –≤ Godot C# (–ø–æ—Ç–æ–ª–æ–∫ ~5K —Å—É—â–Ω–æ—Å—Ç–µ–π)

–≠–¢–ê–ü 1: –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞ Go (2-3 –Ω–µ–¥–µ–ª–∏)
‚îú‚îÄ‚îÄ –ó–∞–±–µ—Ä–∏ —Å–≤–æ–π ECS —Å Go-–ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ –ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ DOD (SoA –≤–º–µ—Å—Ç–æ AoS)
‚îú‚îÄ‚îÄ Command Pattern –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
‚îú‚îÄ‚îÄ Spatial Hash Grid
‚îú‚îÄ‚îÄ Effect System (–µ–¥–∏–Ω–∞—è)
‚îú‚îÄ‚îÄ Event Log
‚îî‚îÄ‚îÄ –¢–µ—Å—Ç—ã: 10000 –≤—Ä–∞–≥–æ–≤, –∑–∞–º–µ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–≠–¢–ê–ü 2: Godot –∫–ª–∏–µ–Ω—Ç ‚Äî —Ç—É–ø–æ–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä (2 –Ω–µ–¥–µ–ª–∏)
‚îú‚îÄ‚îÄ MultiMeshInstance2D –¥–ª—è –±–∞—Ç—á-—Ä–µ–Ω–¥–µ—Ä–∞
‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å–Ω–∞—á–∞–ª–∞ –ª–æ–∫–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º –ø–æ —Å–µ—Ç–∏)
‚îú‚îÄ‚îÄ –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –º–µ–∂–¥—É —Ç–∏–∫–∞–º–∏
‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ UI (HUD, –ø–∞–Ω–µ–ª–∏)
‚îî‚îÄ‚îÄ –≠—Ñ—Ñ–µ–∫—Ç—ã (—á–∞—Å—Ç–∏—Ü—ã, –≤—Å–ø—ã—à–∫–∏)

–≠–¢–ê–ü 3: –°–≤—è–∑–∫–∞ (1-2 –Ω–µ–¥–µ–ª–∏)
‚îú‚îÄ‚îÄ WebSocket –º–µ–∂–¥—É Go –∏ Godot
‚îú‚îÄ‚îÄ –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (Protocol Buffers –∏–ª–∏ MessagePack)
‚îú‚îÄ‚îÄ Delta Compression
‚îú‚îÄ‚îÄ Client-side prediction –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –±–∞—à–µ–Ω
‚îî‚îÄ‚îÄ –õ–∞–≥-–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è

–≠–¢–ê–ü 4: –ö–æ–Ω—Ç–µ–Ω—Ç –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞ (ongoing)
‚îú‚îÄ‚îÄ –í—Å–µ —Ç–∏–ø—ã –±–∞—à–µ–Ω
‚îú‚îÄ‚îÄ –í—Å–µ —Ç–∏–ø—ã –≤—Ä–∞–≥–æ–≤
‚îú‚îÄ‚îÄ –ö—Ä–∞—Ñ—Ç
‚îú‚îÄ‚îÄ –≠–Ω–µ—Ä–≥–æ—Å–µ—Ç—å
‚îú‚îÄ‚îÄ –ë–∞–ª–∞–Ω—Å
‚îî‚îÄ‚îÄ –í–∏–∑—É–∞–ª
```

---

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã ‚Äî –∏—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ó–∞—á–µ–º | –ö–æ–≥–¥–∞ –≤–Ω–µ–¥—Ä—è—Ç—å |
|---------|-------|----------------|
| **Command Pattern** | –û–Ω–ª–∞–π–Ω, replay, undo, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º | –°—Ä–∞–∑—É |
| **DOD / SoA** | 10K+ —Å—É—â–Ω–æ—Å—Ç–µ–π –±–µ–∑ –ª–∞–≥–æ–≤ | –°—Ä–∞–∑—É |
| **Spatial Hash** | O(1) –ø–æ–∏—Å–∫ —Å–æ—Å–µ–¥–µ–π –≤–º–µ—Å—Ç–æ O(n¬≤) | –°—Ä–∞–∑—É |
| **Dirty Flags** | –ù–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å–µ—Ç—å/–ø—É—Ç–∏ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä | –°—Ä–∞–∑—É |
| **Unified Effect System** | –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –±–µ–∑ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º | –°—Ä–∞–∑—É |
| **Event Sourcing** | –î–µ–±–∞–≥, replay, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Å–µ—Ç—å | –≠—Ç–∞–ø 1 |
| **Delta Compression** | –°–µ—Ç—å: 10K —Å—É—â–Ω–æ—Å—Ç–µ–π –ø–æ WebSocket | –≠—Ç–∞–ø 3 |
| **MultiMesh Batching** | –†–µ–Ω–¥–µ—Ä 10K —Å–ø—Ä–∞–π—Ç–æ–≤ = 1 draw call | –≠—Ç–∞–ø 2 |
| **Object Pool** | –ú–µ–Ω—å—à–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π, –º–µ–Ω—å—à–µ GC | –≠—Ç–∞–ø 2 |
| **State Machine** | –§–∞–∑—ã –∏–≥—Ä—ã, AI –≤—Ä–∞–≥–æ–≤ (–µ—Å–ª–∏ –±—É–¥–µ—Ç) | –ï—Å—Ç—å |
| **CQRS** | –ß—Ç–µ–Ω–∏–µ ‚â† –∑–∞–ø–∏—Å—å, —Å–µ—Ä–≤–µ—Ä ‚â† –∫–ª–∏–µ–Ω—Ç | –≠—Ç–∞–ø 3 |

---

## –ì–ª–∞–≤–Ω—ã–π —Å–æ–≤–µ—Ç

–¢—ã Go-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –¢—ã –Ω–µ–Ω–∞–≤–∏–¥–∏—à—å –¥–≤–∏–∂–∫–∏. –¢—ã —Ö–æ—á–µ—à—å 10K —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –æ–Ω–ª–∞–π–Ω.

**–ù–µ –ø–∏—à–∏ —Å–∏–º—É–ª—è—Ü–∏—é –≤ Godot.** Godot ‚Äî —Ç–≤–æ–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä. Go ‚Äî —Ç–≤–æ–π –º–æ–∑–≥. –≠—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞—Å—Ç —Ç–µ–±–µ:

- –ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å (Go –±—ã—Å—Ç—Ä–µ–µ GDScript –≤ 50-100 —Ä–∞–∑ –Ω–∞ –ª–æ–≥–∏–∫–µ)
- –û–Ω–ª–∞–π–Ω (Go —Å–µ—Ä–≤–µ—Ä —É–∂–µ –∞–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π)
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (Go —Ç–µ—Å—Ç—ã –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –¥–≤–∏–∂–∫–∞)
- –°–≤–æ–±–æ–¥—É (–∑–∞–≤—Ç—Ä–∞ –∑–∞—Ö–æ—á–µ—à—å 3D ‚Äî –º–µ–Ω—è–µ—à—å —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç)

–¢—ã —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª –ø–æ–ª–æ–≤–∏–Ω—É —ç—Ç–æ–≥–æ –Ω–∞ Go. –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–π ‚Äî —Ä–∞–∑–≤–∏–≤–∞–π.


# –ë—ã—Å—Ç—Ä—ã–π –ø–ª–∞–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ MVP

–ó–∞–±—É–¥—å –ø–æ–∫–∞ –ø—Ä–æ Go-—Å–µ—Ä–≤–µ—Ä, –æ–Ω–ª–∞–π–Ω, 10K —Å—É—â–Ω–æ—Å—Ç–µ–π. –í—Å—ë —ç—Ç–æ –ø–æ—Ç–æ–º. –°–µ–π—á–∞—Å —Ü–µ–ª—å –æ–¥–Ω–∞ ‚Äî **–∏–≥—Ä–∞–±–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –∑–∞ 2 –Ω–µ–¥–µ–ª–∏**.

---

## –ü—Ä–∏–Ω—Ü–∏–ø: –≤—Å—ë –≤ Godot, –≤—Å—ë –Ω–∞ GDScript, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä –ø–æ—Ç–æ–º

```
–°–µ–π—á–∞—Å:  GDScript –º–æ–Ω–æ–ª–∏—Ç ‚Üí —Ä–∞–±–æ—Ç–∞—é—â–∞—è –∏–≥—Ä–∞
–ü–æ—Ç–æ–º:   –í—ã–Ω–æ—Å–∏—à—å —Å–∏–º—É–ª—è—Ü–∏—é –≤ Go, Godot = —Ä–µ–Ω–¥–µ—Ä–µ—Ä
```

–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ ‚Äî **Command Pattern —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è**. –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–æ —Ç—ã –≤–Ω–µ–¥—Ä—è–µ—à—å "–Ω–∞ –±—É–¥—É—â–µ–µ". –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç—É–ø–æ –∏ –±—ã—Å—Ç—Ä–æ.

---

## –ß—Ç–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å (—Ä–∞–±–æ—Ç–∞–µ—Ç)

```
‚úÖ ECS World
‚úÖ –ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚úÖ A* pathfinding
‚úÖ JSON –¥–∞–Ω–Ω—ã–µ (–±–∞—à–Ω–∏, –≤—Ä–∞–≥–∏, –≤–æ–ª–Ω—ã)
‚úÖ –ö–∞–º–µ—Ä–∞ (WASD, zoom)
‚úÖ Config
‚úÖ GameManager
‚úÖ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥–µ–∫—Å–æ–≤, entry, exit, checkpoints
```

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è MVP (–º–∏–Ω–∏–º—É–º)

```
–ò–≥—Ä–æ–∫ –∫–ª–∏–∫–∞–µ—Ç ‚Üí –±–∞—à–Ω—è —Å—Ç–∞–≤–∏—Ç—Å—è ‚Üí –≤—Ä–∞–≥–∏ —Å–ø–∞–≤–Ω—è—Ç—Å—è ‚Üí
‚Üí –≤—Ä–∞–≥–∏ –∏–¥—É—Ç ‚Üí –±–∞—à–Ω–∏ —Å—Ç—Ä–µ–ª—è—é—Ç ‚Üí –≤—Ä–∞–≥–∏ —É–º–∏—Ä–∞—é—Ç ‚Üí
‚Üí –≤–æ–ª–Ω–∞ –∫–æ–Ω—á–∞–µ—Ç—Å—è ‚Üí –Ω–æ–≤–∞—è —Ñ–∞–∑–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
```

**7 —Ñ–∞–π–ª–æ–≤. –í—Å—ë.**

---

## –î–µ–Ω—å 1: –ö–æ–º–∞–Ω–¥—ã + —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –±–∞—à–µ–Ω

–û–¥–∏–Ω —Ñ–∞–π–ª ‚Äî –≤—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞:

```gdscript
# core/systems/input_system.gd
class_name InputSystem

var ecs: ECSWorld
var hex_map: HexMap

func handle_click(world_pos: Vector2, button: int):
    var hex = Hex.pixel_to_hex(world_pos, Config.HEX_SIZE)
    
    if button == MOUSE_BUTTON_LEFT:
        _try_place_tower(hex)
    elif button == MOUSE_BUTTON_RIGHT:
        _try_remove_tower(hex)

func _try_place_tower(hex: Vector2i):
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    var tile = hex_map.get_tile(hex)
    if tile == null or not tile.passable or tile.has_tower:
        return
    if ecs.game_state["phase"] != GameTypes.BUILD_STATE:
        return
    if ecs.game_state["towers_built"] >= 5:
        return
    
    # –°–æ–∑–¥–∞—ë–º
    var id = ecs.create_entity()
    var pos = Hex.to_pixel(hex.x, hex.y, Config.HEX_SIZE)
    ecs.positions[id] = pos
    ecs.towers[id] = {
        "def_id": "TA",
        "hex": hex,
        "type": "ATTACK",
        "damage": 25,
        "range": Config.HEX_SIZE * 3,
        "fire_rate": 1.0,
        "cooldown": 0.0,
    }
    
    tile.has_tower = true
    tile.tower_id = id
    ecs.game_state["towers_built"] += 1
```

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ game_root.gd:**

```gdscript
func _unhandled_input(event):
    if event is InputEventMouseButton and event.pressed:
        var world_pos = get_global_mouse_position()
        input_system.handle_click(world_pos, event.button_index)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–Ω—è 1:** –∫–ª–∏–∫–∞–µ—à—å ‚Äî –Ω–∞ –≥–µ–∫—Å–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –±–∞—à–Ω—è.

---

## –î–µ–Ω—å 2: –†–µ–Ω–¥–µ—Ä –±–∞—à–µ–Ω –∏ –≤—Ä–∞–≥–æ–≤ (—Ç—É–ø–æ–π)

–û–¥–∏–Ω —Ñ–∞–π–ª ‚Äî —Ä–∏—Å—É–µ—Ç –≤—Å—ë:

```gdscript
# godot_adapter/rendering/entity_renderer.gd
extends Node2D

var ecs: ECSWorld
var tower_nodes: Dictionary = {}   # entity_id -> Node2D
var enemy_nodes: Dictionary = {}

func _process(_delta):
    _sync_towers()
    _sync_enemies()

func _sync_towers():
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ
    for id in ecs.towers:
        if id not in tower_nodes:
            var node = _make_circle(12.0, Color.ORANGE)
            node.position = ecs.positions[id]
            add_child(node)
            tower_nodes[id] = node
    
    # –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–µ
    for id in tower_nodes.keys():
        if id not in ecs.towers:
            tower_nodes[id].queue_free()
            tower_nodes.erase(id)

func _sync_enemies():
    for id in ecs.enemies:
        if id not in enemy_nodes:
            var node = _make_circle(8.0, Color.RED)
            add_child(node)
            enemy_nodes[id] = node
        enemy_nodes[id].position = ecs.positions[id]
    
    for id in enemy_nodes.keys():
        if id not in ecs.enemies:
            enemy_nodes[id].queue_free()
            enemy_nodes.erase(id)

func _make_circle(radius: float, color: Color) -> Node2D:
    var node = Node2D.new()
    var polygon = Polygon2D.new()
    var points = PackedVector2Array()
    for i in 16:
        var angle = TAU * i / 16.0
        points.append(Vector2(cos(angle), sin(angle)) * radius)
    polygon.polygon = points
    polygon.color = color
    node.add_child(polygon)
    return node
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–Ω—è 2:** –≤–∏–¥–∏—à—å –±–∞—à–Ω–∏ (–æ—Ä–∞–Ω–∂–µ–≤—ã–µ –∫—Ä—É–≥–∏) –∏ –≤—Ä–∞–≥–æ–≤ (–∫—Ä–∞—Å–Ω—ã–µ –∫—Ä—É–≥–∏).

---

## –î–µ–Ω—å 3: –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤

```gdscript
# core/systems/wave_system.gd
class_name WaveSystem

var ecs: ECSWorld
var hex_map: HexMap
var spawn_timer: float = 0.0
var enemies_to_spawn: int = 0
var current_enemy_def: Dictionary = {}
var spawn_path: Array = []

func start_wave(wave_number: int):
    var wave_def = GameManager.get_wave_def(wave_number)
    current_enemy_def = GameManager.get_enemy_def(wave_def["enemy_id"])
    enemies_to_spawn = wave_def["count"]
    spawn_timer = 0.0
    
    # –°—á–∏—Ç–∞–µ–º –ø—É—Ç—å –æ–¥–∏–Ω —Ä–∞–∑
    spawn_path = _build_full_path()

func update(delta: float):
    if ecs.game_state["phase"] != GameTypes.WAVE_STATE:
        return
    if enemies_to_spawn <= 0:
        _check_wave_complete()
        return
    
    spawn_timer -= delta
    if spawn_timer <= 0:
        _spawn_one_enemy()
        spawn_timer = 0.8  # –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–ø–∞–≤–Ω–∞
        enemies_to_spawn -= 1

func _spawn_one_enemy():
    var id = ecs.create_entity()
    var start_hex = spawn_path[0]
    ecs.positions[id] = Hex.to_pixel(start_hex.x, start_hex.y, Config.HEX_SIZE)
    ecs.enemies[id] = {
        "def_id": current_enemy_def["id"],
        "speed": current_enemy_def.get("speed", 80.0),
        "physical_armor": current_enemy_def.get("physical_armor", 0),
        "magical_armor": current_enemy_def.get("magical_armor", 0),
    }
    ecs.healths[id] = {
        "current": current_enemy_def.get("health", 100),
        "max": current_enemy_def.get("health", 100),
    }
    ecs.paths[id] = {
        "hexes": spawn_path.duplicate(),
        "index": 0,
    }

func _build_full_path() -> Array:
    var full_path = []
    var waypoints = [hex_map.entry] + hex_map.checkpoints + [hex_map.exit]
    for i in range(waypoints.size() - 1):
        var segment = Pathfinding.a_star(hex_map, waypoints[i], waypoints[i + 1])
        if i > 0 and segment.size() > 0:
            segment.remove_at(0)  # —É–±—Ä–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç
        full_path.append_array(segment)
    return full_path

func _check_wave_complete():
    if ecs.enemies.is_empty():
        ecs.game_state["phase"] = GameTypes.BUILD_STATE
        ecs.game_state["towers_built"] = 0
        ecs.game_state["current_wave"] += 1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–Ω—è 3:** –≤—Ä–∞–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥–µ.

---

## –î–µ–Ω—å 4: –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤

```gdscript
# core/systems/movement_system.gd
class_name MovementSystem

var ecs: ECSWorld
var hex_map: HexMap

func update(delta: float):
    if ecs.game_state["phase"] != GameTypes.WAVE_STATE:
        return
    
    var dead_enemies = []
    
    for id in ecs.enemies:
        var path = ecs.paths.get(id)
        if path == null:
            continue
        
        var target_hex = path["hexes"][path["index"]]
        var target_pos = Hex.to_pixel(
            target_hex.x, target_hex.y, Config.HEX_SIZE
        )
        var current_pos: Vector2 = ecs.positions[id]
        var direction = (target_pos - current_pos)
        var distance = direction.length()
        
        var speed = ecs.enemies[id]["speed"]
        
        if distance < speed * delta:
            # –î–æ—Å—Ç–∏–≥–ª–∏ —Ç–æ—á–∫–∏
            ecs.positions[id] = target_pos
            path["index"] += 1
            
            # –ö–æ–Ω–µ—Ü –ø—É—Ç–∏ ‚Äî —É—Ä–æ–Ω –∏–≥—Ä–æ–∫—É
            if path["index"] >= path["hexes"].size():
                ecs.player_states["health"] -= 1
                dead_enemies.append(id)
        else:
            ecs.positions[id] = current_pos + direction.normalized() * speed * delta
    
    for id in dead_enemies:
        ecs.destroy_entity(id)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–Ω—è 4:** –≤—Ä–∞–≥–∏ –∏–¥—É—Ç –æ—Ç –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ —á–µ–∫–ø–æ–∏–Ω—Ç—ã –∫ –≤—ã—Ö–æ–¥—É.

---

## –î–µ–Ω—å 5: –ë–∞—à–Ω–∏ —Å—Ç—Ä–µ–ª—è—é—Ç

```gdscript
# core/systems/combat_system.gd
class_name CombatSystem

var ecs: ECSWorld

func update(delta: float):
    if ecs.game_state["phase"] != GameTypes.WAVE_STATE:
        return
    
    for tower_id in ecs.towers:
        var tower = ecs.towers[tower_id]
        tower["cooldown"] = max(0.0, tower["cooldown"] - delta)
        
        if tower["cooldown"] > 0:
            continue
        
        # –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–µ–≥–æ –≤—Ä–∞–≥–∞ –≤ —Ä–∞–¥–∏—É—Å–µ
        var tower_pos: Vector2 = ecs.positions[tower_id]
        var best_id = -1
        var best_dist = tower["range"]
        
        for enemy_id in ecs.enemies:
            var dist = tower_pos.distance_to(ecs.positions[enemy_id])
            if dist < best_dist:
                best_dist = dist
                best_id = enemy_id
        
        if best_id == -1:
            continue
        
        # –°—Ç—Ä–µ–ª—è–µ–º ‚Äî —Å–æ–∑–¥–∞—ë–º —Å–Ω–∞—Ä—è–¥
        var proj_id = ecs.create_entity()
        ecs.positions[proj_id] = tower_pos
        ecs.projectiles[proj_id] = {
            "target_id": best_id,
            "damage": tower["damage"],
            "speed": 300.0,
        }
        
        tower["cooldown"] = 1.0 / tower["fire_rate"]
```

---

## –î–µ–Ω—å 6: –°–Ω–∞—Ä—è–¥—ã –ª–µ—Ç—è—Ç –∏ –ø–æ–ø–∞–¥–∞—é—Ç

```gdscript
# core/systems/projectile_system.gd
class_name ProjectileSystem

var ecs: ECSWorld

func update(delta: float):
    var to_remove = []
    
    for proj_id in ecs.projectiles:
        var proj = ecs.projectiles[proj_id]
        var target_id = proj["target_id"]
        
        # –¶–µ–ª—å —É–º–µ—Ä–ª–∞ ‚Äî —É–¥–∞–ª–∏—Ç—å —Å–Ω–∞—Ä—è–¥
        if target_id not in ecs.positions:
            to_remove.append(proj_id)
            continue
        
        var pos: Vector2 = ecs.positions[proj_id]
        var target_pos: Vector2 = ecs.positions[target_id]
        var direction = (target_pos - pos)
        var dist = direction.length()
        
        # –ü–æ–ø–∞–¥–∞–Ω–∏–µ
        if dist < 10.0:
            _hit(proj, target_id)
            to_remove.append(proj_id)
            continue
        
        # –î–≤–∏–∂–µ–Ω–∏–µ
        ecs.positions[proj_id] = pos + direction.normalized() * proj["speed"] * delta
    
    for id in to_remove:
        ecs.destroy_entity(id)

func _hit(proj: Dictionary, target_id: int):
    if target_id not in ecs.healths:
        return
    
    var health = ecs.healths[target_id]
    var armor = ecs.enemies[target_id].get("physical_armor", 0)
    var final_damage = max(proj["damage"] - armor, 1)
    
    health["current"] -= final_damage
    
    if health["current"] <= 0:
        ecs.destroy_entity(target_id)
        ecs.game_state["total_kills"] = ecs.game_state.get("total_kills", 0) + 1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–Ω—è 6:** –±–∞—à–Ω–∏ —Å—Ç—Ä–µ–ª—è—é—Ç, –≤—Ä–∞–≥–∏ —É–º–∏—Ä–∞—é—Ç.

---

## –î–µ–Ω—å 7: –°–º–µ–Ω–∞ —Ñ–∞–∑ + –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π HUD

```gdscript
# –í game_root.gd ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–∑
func _input(event):
    if event.is_action_pressed("ui_accept"):  # Space
        match ecs.game_state["phase"]:
            GameTypes.BUILD_STATE:
                ecs.game_state["phase"] = GameTypes.WAVE_STATE
                wave_system.start_wave(ecs.game_state["current_wave"])
            GameTypes.WAVE_STATE:
                pass  # –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

HUD ‚Äî –æ–¥–∏–Ω Label:

```gdscript
# godot_adapter/ui/game_hud.gd
extends CanvasLayer

var label: Label

func _ready():
    label = Label.new()
    label.position = Vector2(10, 10)
    label.add_theme_font_size_override("font_size", 20)
    add_child(label)

func _process(_delta):
    var gs = GameManager.ecs.game_state
    var ps = GameManager.ecs.player_states
    label.text = "HP: %d | Wave: %d | Phase: %s | Kills: %d | Towers: %d/5" % [
        ps.get("health", 10),
        gs.get("current_wave", 1),
        _phase_name(gs.get("phase", 0)),
        gs.get("total_kills", 0),
        gs.get("towers_built", 0),
    ]

func _phase_name(phase: int) -> String:
    match phase:
        GameTypes.BUILD_STATE: return "BUILD"
        GameTypes.WAVE_STATE: return "WAVE"
        _: return "???"
```

---

## –ò—Ç–æ–≥–æ: 7 –¥–Ω–µ–π ‚Üí –∏–≥—Ä–∞–±–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø

```
–î–µ–Ω—å 1: –ö–ª–∏–∫ ‚Üí –±–∞—à–Ω—è –Ω–∞ –∫–∞—Ä—Ç–µ              ‚úì input_system.gd
–î–µ–Ω—å 2: –í–∏–¥–∏—à—å –±–∞—à–Ω–∏ –∏ –≤—Ä–∞–≥–æ–≤              ‚úì entity_renderer.gd
–î–µ–Ω—å 3: –í—Ä–∞–≥–∏ —Å–ø–∞–≤–Ω—è—Ç—Å—è                    ‚úì wave_system.gd
–î–µ–Ω—å 4: –í—Ä–∞–≥–∏ –∏–¥—É—Ç –ø–æ –ø—É—Ç–∏                 ‚úì movement_system.gd
–î–µ–Ω—å 5: –ë–∞—à–Ω–∏ —Å—Ç—Ä–µ–ª—è—é—Ç                     ‚úì combat_system.gd
–î–µ–Ω—å 6: –°–Ω–∞—Ä—è–¥—ã –ø–æ–ø–∞–¥–∞—é—Ç, –≤—Ä–∞–≥–∏ —É–º–∏—Ä–∞—é—Ç    ‚úì projectile_system.gd
–î–µ–Ω—å 7: –§–∞–∑—ã + HUD                        ‚úì game_hud.gd
```

**7 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤. ~400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞. –†–∞–±–æ—á–∞—è –∏–≥—Ä–∞.**

---

## –ù–µ–¥–µ–ª—è 2: –¥–æ–±–∞–≤–ª—è–µ–º –º—è—Å–æ

```
–î–µ–Ω—å 8:  –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –±–∞—à–µ–Ω (—á–∏—Ç–∞–µ–º –∏–∑ JSON –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞)
–î–µ–Ω—å 9:  –£–¥–∞–ª–µ–Ω–∏–µ –±–∞—à–µ–Ω + —Å—Ç–µ–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –ø—É—Ç—å
–î–µ–Ω—å 10: –§–∞–∑–∞ SELECTION (–≤—ã–±–æ—Ä 2 –∏–∑ 5)
–î–µ–Ω—å 11: –≠–Ω–µ—Ä–≥–æ—Å–µ—Ç—å (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è: –º–∞–π–Ω–µ—Ä —Ä—è–¥–æ–º = –±–∞—à–Ω—è –∞–∫—Ç–∏–≤–Ω–∞)
–î–µ–Ω—å 12: –†—É–¥–∞ –Ω–∞ –∫–∞—Ä—Ç–µ (3 –∂–∏–ª—ã, –≤–∏–∑—É–∞–ª)
–î–µ–Ω—å 13: Slow + Poison —ç—Ñ—Ñ–µ–∫—Ç—ã
–î–µ–Ω—å 14: –ü–æ–ª–∏—Ä–æ–≤–∫–∞, –±–∞–ª–∞–Ω—Å, —Ñ–∏–∫—Å –±–∞–≥–æ–≤
```

---

## –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å –≤ —ç—Ç–∏ 2 –Ω–µ–¥–µ–ª–∏

```
‚ùå Resource-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã      ‚Üí —Å–ª–æ–≤–∞—Ä–∏ –æ–∫ –¥–ª—è MVP
‚ùå PhaseController           ‚Üí match –≤ game_root —Ö–≤–∞—Ç–∏—Ç
‚ùå EventBus                  ‚Üí –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –æ–∫
‚ùå DataRepository            ‚Üí GameManager —Ö–≤–∞—Ç–∏—Ç
‚ùå SpatialHash               ‚Üí brute force –Ω–∞ 50 –≤—Ä–∞–≥–∞—Ö –æ–∫
‚ùå MultiMesh                 ‚Üí Polygon2D –Ω–∞ 50 –≤—Ä–∞–≥–∞—Ö –æ–∫
‚ùå –û–Ω–ª–∞–π–Ω                    ‚Üí –ø–æ—Ç–æ–º
‚ùå –ö—Ä–∞—Å–∏–≤—ã–µ —Å–ø—Ä–∞–π—Ç—ã          ‚Üí –∫—Ä—É–≥–∏ –∏ –∫–≤–∞–¥—Ä–∞—Ç—ã
‚ùå –ó–≤—É–∫                      ‚Üí –ø–æ—Ç–æ–º
‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ                ‚Üí –ø–æ—Ç–æ–º
```

–°–Ω–∞—á–∞–ª–∞ –∏–≥—Ä–∞–µ—à—å. –ü–æ—Ç–æ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—à—å. –ü–æ—Ç–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—à—å.